(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&e(i)}).observe(document,{childList:!0,subtree:!0});function a(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(n){if(n.ep)return;n.ep=!0;const r=a(n);fetch(n.href,r)}})();class T{constructor(t,a,e){this.parent=t,this.onClick=a,this.onDelete=e}render(t){const a=`
            <div class="card m-2" style="width: 18rem;">
                <img src="${t.src}" class="card-img-top" alt="${t.title}">
                <div class="card-body">
                    <h5 class="card-title">${t.title}</h5>
                    <p class="card-text">${t.text}</p>
                    <button class="btn btn-primary mb-1" data-id="${t.id}" data-action="open">Открыть сообщество</button>
                    <button class="btn btn-danger" data-id="${t.id}" data-action="delete">Удалить</button>
                </div>
            </div>
        `;this.parent.insertAdjacentHTML("beforeend",a);const e=this.parent.lastElementChild,n=e.querySelector('[data-action="open"]'),r=e.querySelector('[data-action="delete"]');n.addEventListener("click",this.onClick),r.addEventListener("click",this.onClick)}}class N{get(t,a){fetch(t).then(e=>e.json().then(n=>a(n,e.status))).catch(e=>{console.error("GET error:",e),a(null,500)})}post(t,a,e){fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(async n=>{const r=await n.text();let i=null;try{i=r?JSON.parse(r):null}catch{console.warn("Не удалось распарсить JSON из ответа")}e(i,n.status)}).catch(n=>{console.error("POST error:",n),e(null,500)})}patch(t,a,e){fetch(t,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(n=>n.json().then(r=>e(r,n.status))).catch(n=>{console.error("PATCH error:",n),e(null,500)})}delete(t,a){fetch(t,{method:"DELETE"}).then(e=>e.json().then(n=>a(n,e.status))).catch(e=>{console.error("DELETE error:",e),a(null,500)})}}const y=new N;class P{constructor(){this.baseUrl="http://localhost:3000"}getCommunities(){return`${this.baseUrl}/communities`}getCommunitieById(t){return`${this.baseUrl}/communities/${t}`}createCommunitie(){return`${this.baseUrl}/communities`}removeCommunitieById(t){return`${this.baseUrl}/communities/${t}`}updateCommunitieById(t){return`${this.baseUrl}/communities/${t}`}}const v=new P;class k{constructor(t){this.parent=t}render(){this.parent.insertAdjacentHTML("afterbegin",`
            <nav class="navbar navbar-light bg-light">
                <div class="container">
                    <a class="navbar-brand" href="#"><img src="VK.png" width="240" height="40" alt="Логотип"></a>
                    <button class="btn btn-outline-primary" id="home-btn">Домой</button>
                </div>
            </nav>
        `),document.getElementById("home-btn").addEventListener("click",()=>{new L(this.parent).render()})}}class S{constructor(t){this.parent=t}addListeners(t){document.getElementById("back-button").addEventListener("click",t)}getHTML(){return`
                <button id="back-button" class="btn btn-primary" type="button">Назад</button>
            `}render(t){const a=this.getHTML();this.parent.insertAdjacentHTML("beforeend",a),this.addListeners(t)}}class ${constructor(t,a){this.parent=t,this.id=a,this.pageRoot=document.createElement("div"),this.pageRoot.classList.add("container","mt-4")}clickBack(){new L(this.parent).render()}getData(){y.get(v.getCommunitieById(this.id),t=>{this.renderData(t)})}renderData(t){new T(this.pageRoot).render(t);const e=document.createElement("div");e.classList.add("mt-4");const n=document.createElement("input");n.className="form-control mb-2",n.value=t.title;const r=document.createElement("textarea");r.className="form-control mb-2",r.value=t.text;const i=document.createElement("button");i.className="btn btn-primary",i.textContent="Сохранить изменения",e.appendChild(n),e.appendChild(r),e.appendChild(i),this.pageRoot.appendChild(e),i.addEventListener("click",()=>{const l={...t,title:n.value.trim(),text:r.value.trim()};y.patch(v.updateCommunitieById(t.id),l,(h,p)=>{const d=this.pageRoot.querySelector(".save-success-msg");d&&d.remove();const u=document.createElement("div");u.className="alert alert-success save-success-msg mt-3",u.textContent="Изменения сохранены",e.appendChild(u),setTimeout(()=>{u.remove()},3e3),this.render()})})}render(){this.parent.innerHTML="",new k(this.parent).render(),this.parent.appendChild(this.pageRoot),new S(this.pageRoot).render(this.clickBack.bind(this)),this.getData()}}function I(s,t=", "){if(!Array.isArray(s))throw new TypeError("Ожидается массив");return s.join(t)}function D(s,t,a){if(!Array.isArray(s))throw new TypeError("Первый аргумент должен быть массивом");if(t<0||t>=s.length||a<0||a>=s.length)return s;const e=[...s],[n]=e.splice(t,1);return e.splice(a,0,n),e}function M(s,t){if(!Array.isArray(s)||!Array.isArray(t))return console.error("Ожидаются два массива в качестве аргументов."),[];const a=[];return s.forEach(e=>{t.includes(e)||a.push(e)}),a}function j(s){if(typeof s!="string"&&typeof s!="number")return!1;const t=String(s).toLowerCase().replace(/[^a-zа-я0-9]/gi,"");return t===t.split("").reverse().join("")}function H(s){if(typeof s!="string"&&typeof s!="number")return!1;const t=String(s).toLowerCase().replace(/[^a-zа-я0-9]/gi,"");for(let a=0;a<t.length/2;a++)if(t[a]!==t[t.length-1-a])return!1;return!0}class L{constructor(t){this.parent=t,this.data=[]}getData(){y.get(v.getCommunities(),t=>{this.renderData(t)})}renderData(t){this.data=t,this.render()}deleteCard(t){y.delete(v.removeCommunitieById(t),()=>{this.data=this.data.filter(a=>a.id!=t),this.render()})}showAddCardForm(){if(document.getElementById("new-title"))return;const t=document.createElement("div");t.id="new-card-form",t.classList.add("card","p-3","mb-3"),t.innerHTML=`
            <div class="mb-2">
                <label class="form-label">Название:</label>
                <input type="text" class="form-control" id="new-title" placeholder="Название сообщества" />
            </div>
            <div class="mb-2">
                <label class="form-label">Участники (через запятую):</label>
                <input type="text" class="form-control" id="new-participants" placeholder="Участник 1, Участник 2" />
            </div>
            <div class="mb-2">
                <label class="form-label">Описание:</label>
                <textarea class="form-control" id="new-description" placeholder="Описание сообщества"></textarea>
            </div>
            <div class="mb-2">
                <label class="form-label">URL картинки:</label>
                <input type="text" class="form-control" id="new-image-url" placeholder="https://example.com/image.jpg" />
            </div>
            <button type="button" class="btn btn-success" id="submit-new-card">Создать</button>
        `;const a=document.querySelector(".container.mt-3");a.insertBefore(t,a.firstChild),t.querySelector("#submit-new-card").addEventListener("click",e=>{e.preventDefault();const n=document.getElementById("new-title").value.trim(),r=document.getElementById("new-participants").value,i=document.getElementById("new-description").value.trim(),l=document.getElementById("new-image-url").value.trim();if(!n||!i||!l.startsWith("http")){alert("Заполните корректно все поля.");return}const h=r.split(",").map(d=>d.trim()).filter(Boolean),p={title:n,participants:h,src:l,text:i};y.post(v.createCommunitie(),p,(d,u)=>{this.data.unshift(d);const m=document.createElement("div");m.className="alert alert-success",m.textContent="Новое сообщество успешно создано!";const b=document.querySelector(".container.mt-3");b.parentNode.insertBefore(m,b),setTimeout(()=>{m.remove()},3e3),t.remove(),this.render()})})}clickCard(t){const a=t.target.dataset.id,e=t.target.dataset.action;e==="open"?new $(this.parent,a).render():e==="delete"&&this.deleteCard(a)}renderWithData(t){const a=this.data;this.data=t,this.render(),this.data=a}render(){this.parent.innerHTML="",new k(this.parent).render(),this.parent.insertAdjacentHTML("beforeend",`
            <div class="container mt-3">
                <label class="form-label">Поиск по названию:</label>
                <input class="form-control mb-3" id="search-input" placeholder="Введите название сообщества" />
                <button class="btn btn-outline-secondary mb-2" id="search-btn">Найти</button>
            </div>
            <div class="container mt-3">
                <button class="btn btn-primary mb-3" id="add-btn">Добавить сообщество</button>
                <div id="card-list" class="d-flex flex-wrap"></div>
            </div>
        `);const a=document.getElementById("card-list");if(!this.data||this.data.length===0){this.getData();return}this.data.forEach((e,n)=>{const r=document.createElement("div");r.classList.add("m-2","p-3","bg-white"),new T(r,this.clickCard.bind(this),this.deleteCard.bind(this)).render(e);const l=r.querySelector(".card-body, .card-footer, .actions")||r,h=document.createElement("div");h.classList.add("mt-2","d-flex","gap-2");const p=document.createElement("button");p.className="btn btn-sm btn-outline-primary",p.textContent="🔼",p.dataset.index=n,p.dataset.dir="up";const d=document.createElement("button");d.className="btn btn-sm btn-outline-primary",d.textContent="🔽",d.dataset.index=n,d.dataset.dir="down",h.appendChild(p),h.appendChild(d);const u=document.createElement("button");u.className="btn btn-sm btn-outline-primary",u.textContent="Показать участников";const m=document.createElement("button");m.className="btn btn-sm btn-outline-secondary",m.textContent="Сравнить участников";const b=document.createElement("button");b.className="btn btn-sm btn-outline-primary",b.textContent="✏️ Изменить название";const f=document.createElement("div");f.classList.add("mt-2","d-flex","gap-2","flex-wrap"),f.appendChild(h),f.appendChild(u),f.appendChild(m),f.appendChild(b);const E=document.createElement("button");E.className="btn btn-sm btn-outline-dark",E.textContent="Палиндром?",f.appendChild(E),E.addEventListener("click",()=>{const c=e.title,o=j(c),w=H(c);alert(`Проверка названия сообщества "${c}":
Метод 1: ${o?"Палиндром":"Не палиндром"}
Метод 2: ${w?"Палиндром":"Не палиндром"}`)}),l.appendChild(f);const g=document.createElement("div");g.style.display="none",g.classList.add("mt-2","p-2","bg-light","rounded","border");const A=I(e.participants||[],", ");g.innerHTML=`<div><strong>Участники:</strong> ${A}</div>`,l.appendChild(g),u.addEventListener("click",()=>{const c=g.style.display==="block";g.style.display=c?"none":"block",u.textContent=c?"Показать участников":"Скрыть участников"}),m.addEventListener("click",()=>{const c=this.data.find(o=>o.id!==e.id);if(c){const o=M(e.participants,c.participants);alert(`Участники, которые есть в этом сообществе, но нет в другом:
${I(o)}`)}}),b.addEventListener("click",()=>{const c=r.querySelector(".card-title");if(!c)return;const o=document.createElement("input");o.type="text",o.value=e.title,o.className="form-control form-control-sm",c.replaceWith(o),o.focus();function w(){const C=o.value.trim();if(!C||C===e.title){o.replaceWith(c);return}const B={...e,title:C};y.patch(v.updateCommunitieById(e.id),B,(U,R)=>{this.data=this.data.map(x=>x.id===e.id?B:x),this.render()})}o.addEventListener("blur",w),o.addEventListener("keydown",C=>{C.key==="Enter"&&o.blur()})}),a.appendChild(r)}),a.querySelectorAll("button[data-dir]").forEach(e=>{e.addEventListener("click",n=>{const r=parseInt(n.target.dataset.index),l=n.target.dataset.dir==="up"?r-1:r+1;l>=0&&l<this.data.length&&(this.data=D(this.data,r,l),this.render())})}),document.getElementById("search-btn").addEventListener("click",()=>{const e=document.getElementById("search-input").value.toLowerCase(),n=this.data.filter(r=>r.title.toLowerCase().includes(e));n.length===0?alert("Сообщества не найдены."):this.renderWithData(n)}),document.getElementById("add-btn").addEventListener("click",()=>{this.showAddCardForm()})}}const O=document.getElementById("root"),q=new L(O);q.render();

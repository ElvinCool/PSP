(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function e(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(a){if(a.ep)return;a.ep=!0;const r=e(a);fetch(a.href,r)}})();class E{constructor(t,e,n){this.parent=t,this.onClick=e,this.onDelete=n}render(t){const e=`
            <div class="card m-2" style="width: 18rem;">
                <img src="${t.src}" class="card-img-top" alt="${t.title}">
                <div class="card-body">
                    <h5 class="card-title">${t.title}</h5>
                    <p class="card-text">${t.text}</p>
                    <button class="btn btn-primary mb-1" data-id="${t.id}" data-action="open">Открыть сообщество</button>
                    <button class="btn btn-danger" data-id="${t.id}" data-action="delete">Удалить</button>
                </div>
            </div>
        `;this.parent.insertAdjacentHTML("beforeend",e);const n=this.parent.lastElementChild,a=n.querySelector('[data-action="open"]'),r=n.querySelector('[data-action="delete"]');a.addEventListener("click",this.onClick),r.addEventListener("click",this.onClick)}}class I{get(t,e){fetch(t).then(n=>n.json().then(a=>e(a,n.status))).catch(n=>{console.error("GET error:",n),e(null,500)})}post(t,e,n){fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(async a=>{const r=await a.text();let i=null;try{i=r?JSON.parse(r):null}catch{console.warn("Не удалось распарсить JSON из ответа")}n(i,a.status)}).catch(a=>{console.error("POST error:",a),n(null,500)})}patch(t,e,n){fetch(t,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(a=>a.json().then(r=>n(r,a.status))).catch(a=>{console.error("PATCH error:",a),n(null,500)})}delete(t,e){fetch(t,{method:"DELETE"}).then(n=>n.json().then(a=>e(a,n.status))).catch(n=>{console.error("DELETE error:",n),e(null,500)})}}const f=new I;class S{constructor(){this.baseUrl="http://localhost:3000"}getCommunities(){return`${this.baseUrl}/communities`}getCommunitieById(t){return`${this.baseUrl}/communities/${t}`}createCommunitie(){return`${this.baseUrl}/communities`}removeCommunitieById(t){return`${this.baseUrl}/communities/${t}`}updateCommunitieById(t){return`${this.baseUrl}/communities/${t}`}}const y=new S;class B{constructor(t){this.parent=t}render(){this.parent.insertAdjacentHTML("afterbegin",`
            <nav class="navbar navbar-light bg-light">
                <div class="container">
                    <a class="navbar-brand" href="#"><img src="VK.png" width="240" height="40" alt="Логотип"></a>
                    <button class="btn btn-outline-primary" id="home-btn">Домой</button>
                </div>
            </nav>
        `),document.getElementById("home-btn").addEventListener("click",()=>{new w(this.parent).render()})}}class x{constructor(t){this.parent=t}addListeners(t){document.getElementById("back-button").addEventListener("click",t)}getHTML(){return`
                <button id="back-button" class="btn btn-primary" type="button">Назад</button>
            `}render(t){const e=this.getHTML();this.parent.insertAdjacentHTML("beforeend",e),this.addListeners(t)}}class k{constructor(t,e){this.parent=t,this.id=e,this.pageRoot=document.createElement("div"),this.pageRoot.classList.add("container","mt-4")}clickBack(){new w(this.parent).render()}getData(){f.get(y.getCommunitieById(this.id),t=>{this.renderData(t)})}renderData(t){this.pageRoot.innerHTML="",this.cardContainer=document.createElement("div"),this.pageRoot.appendChild(this.cardContainer),new E(this.cardContainer).render(t);const n=this.cardContainer.querySelector('[data-action="open"]');n&&n.remove();const a=this.cardContainer.querySelector('[data-action="delete"]');a&&a.remove();const r=document.createElement("div");r.classList.add("mt-4");const i=document.createElement("input");i.className="form-control mb-2",i.value=t.title;const o=document.createElement("textarea");o.className="form-control mb-2",o.value=t.text;const u=document.createElement("button");u.className="btn btn-primary me-2",u.textContent="Сохранить изменения";const d=document.createElement("button");d.className="btn btn-secondary",d.textContent="Обновить карточку",r.appendChild(i),r.appendChild(o),r.appendChild(u),r.appendChild(d),this.pageRoot.appendChild(r),u.addEventListener("click",()=>{const h={...t,title:i.value.trim(),text:o.value.trim()};f.patch(y.updateCommunitieById(t.id),h,(m,p)=>{const b=this.pageRoot.querySelector(".save-success-msg");b&&b.remove();const l=document.createElement("div");l.className="alert alert-success save-success-msg mt-3",l.textContent="Изменения сохранены",r.appendChild(l),setTimeout(()=>{l.remove()},3e3)})}),d.addEventListener("click",()=>{f.get(y.getCommunitieById(this.id),h=>{this.cardContainer.innerHTML="",new E(this.cardContainer).render(h);const p=this.cardContainer.querySelector('[data-action="open"]');p&&p.remove();const b=this.cardContainer.querySelector('[data-action="delete"]');b&&b.remove()})});const c=document.createElement("button");c.className="btn btn-outline-primary mb-3 ms-2 mt-2 ",c.textContent="Назад",c.addEventListener("click",this.clickBack.bind(this)),this.pageRoot.appendChild(c)}render(){this.parent.innerHTML="",new B(this.parent).render(),this.parent.appendChild(this.pageRoot),new x(this.pageRoot).render(this.clickBack.bind(this)),this.getData()}}class N{constructor(t,e){this.parent=t,this.id=e,this.pageRoot=document.createElement("div"),this.pageRoot.classList.add("container","mt-4")}clickBack(){new w(this.parent).render()}getData(){f.get(y.getCommunitieById(this.id),t=>{this.renderData(t)})}renderData(t){const e=new E(this.pageRoot);e.render(t);const n=document.createElement("button");n.className="btn btn-outline-success btn-lg mt-3",n.textContent="Изменить данные",n.addEventListener("click",()=>{new k(this.parent,t.id).render()});const a=e.cardElement||e.pageRoot||e.root;a instanceof HTMLElement?a.appendChild(n):this.pageRoot.appendChild(n)}render(){this.parent.innerHTML="",new B(this.parent).render(),this.parent.appendChild(this.pageRoot),new x(this.pageRoot).render(this.clickBack.bind(this)),this.getData()}}function L(s,t=", "){if(!Array.isArray(s))throw new TypeError("Ожидается массив");return s.join(t)}function A(s,t,e){if(!Array.isArray(s))throw new TypeError("Первый аргумент должен быть массивом");if(t<0||t>=s.length||e<0||e>=s.length)return s;const n=[...s],[a]=n.splice(t,1);return n.splice(e,0,a),n}function D(s,t){if(!Array.isArray(s)||!Array.isArray(t))return console.error("Ожидаются два массива в качестве аргументов."),[];const e=[];return s.forEach(n=>{t.includes(n)||e.push(n)}),e}function M(s){if(typeof s!="string"&&typeof s!="number")return!1;const t=String(s).toLowerCase().replace(/[^a-zа-я0-9]/gi,"");return t===t.split("").reverse().join("")}function $(s){if(typeof s!="string"&&typeof s!="number")return!1;const t=String(s).toLowerCase().replace(/[^a-zа-я0-9]/gi,"");for(let e=0;e<t.length/2;e++)if(t[e]!==t[t.length-1-e])return!1;return!0}class w{constructor(t){this.parent=t,this.data=[]}getData(){f.get(y.getCommunities(),t=>{this.renderData(t)})}renderData(t){this.data=t,this.render()}deleteCard(t){f.delete(y.removeCommunitieById(t),()=>{this.data=this.data.filter(e=>e.id!=t),this.render()})}showAddCardForm(){if(document.getElementById("new-title"))return;const t=document.createElement("div");t.id="new-card-form",t.classList.add("card","p-3","mb-3"),t.innerHTML=`
            <div class="mb-2">
                <label class="form-label">Название:</label>
                <input type="text" class="form-control" id="new-title" placeholder="Название сообщества" />
            </div>
            <div class="mb-2">
                <label class="form-label">Участники (через запятую):</label>
                <input type="text" class="form-control" id="new-participants" placeholder="Участник 1, Участник 2" />
            </div>
            <div class="mb-2">
                <label class="form-label">Описание:</label>
                <textarea class="form-control" id="new-description" placeholder="Описание сообщества"></textarea>
            </div>
            <div class="mb-2">
                <label class="form-label">URL картинки:</label>
                <input type="text" class="form-control" id="new-image-url" placeholder="https://example.com/image.jpg" />
            </div>
            <button type="button" class="btn btn-success" id="submit-new-card">Создать</button>
        `;const e=document.querySelector(".container.mt-3");e.insertBefore(t,e.firstChild),t.querySelector("#submit-new-card").addEventListener("click",n=>{n.preventDefault();const a=document.getElementById("new-title").value.trim(),r=document.getElementById("new-participants").value,i=document.getElementById("new-description").value.trim(),o=document.getElementById("new-image-url").value.trim();if(!a||!i||!o.startsWith("http")){alert("Заполните корректно все поля.");return}const u=r.split(",").map(c=>c.trim()).filter(Boolean),d={title:a,participants:u,src:o,text:i};f.post(y.createCommunitie(),d,(c,h)=>{this.data.unshift(c);const m=document.createElement("div");m.className="alert alert-success",m.textContent="Новое сообщество успешно создано!";const p=document.querySelector(".container.mt-3");p.parentNode.insertBefore(m,p),setTimeout(()=>{m.remove()},3e3),t.remove(),this.render()})})}clickCard(t){const e=t.target.dataset.id,n=t.target.dataset.action;n==="open"?new N(this.parent,e).render():n==="delete"&&this.deleteCard(e)}renderWithData(t){const e=this.data;this.data=t,this.render(),this.data=e}render(){this.parent.innerHTML="",new B(this.parent).render(),this.parent.insertAdjacentHTML("beforeend",`
            <div class="container mt-3">
                <label class="form-label">Поиск по названию:</label>
                <input class="form-control mb-3" id="search-input" placeholder="Введите название сообщества" />
                <button class="btn btn-outline-secondary mb-2" id="search-btn">Найти</button>
            </div>
            <div class="container mt-3">
                <button class="btn btn-primary mb-3" id="add-btn">Добавить сообщество</button>
                <div id="card-list" class="d-flex flex-wrap"></div>
            </div>
        `);const e=document.getElementById("card-list");if(!this.data||this.data.length===0){this.getData();return}this.data.forEach((n,a)=>{const r=document.createElement("div");r.classList.add("m-2","p-3","bg-white"),new E(r,this.clickCard.bind(this),this.deleteCard.bind(this)).render(n);const o=r.querySelector(".card-body, .card-footer, .actions")||r,u=document.createElement("div");u.classList.add("mt-2","d-flex","gap-2");const d=document.createElement("button");d.className="btn btn-sm btn-outline-primary",d.textContent="🔼",d.dataset.index=a,d.dataset.dir="up";const c=document.createElement("button");c.className="btn btn-sm btn-outline-primary",c.textContent="🔽",c.dataset.index=a,c.dataset.dir="down",u.appendChild(d),u.appendChild(c);const h=document.createElement("button");h.className="btn btn-sm btn-outline-primary",h.textContent="Показать участников";const m=document.createElement("button");m.className="btn btn-sm btn-outline-secondary",m.textContent="Сравнить участников";const p=document.createElement("button");p.className="btn btn-sm btn-outline-success",p.textContent="Изменить данные",p.addEventListener("click",()=>{new k(this.parent,n.id).render()});const b=document.createElement("button");b.className="btn btn-sm btn-outline-dark",b.textContent="Палиндром?";const l=document.createElement("div");l.classList.add("mt-2","d-flex","gap-2","flex-wrap"),l.appendChild(u),l.appendChild(h),l.appendChild(m),l.appendChild(p),l.appendChild(b),o.appendChild(l);const C=document.createElement("div");C.style.display="none",C.classList.add("mt-2","p-2","bg-light","rounded","border");const P=L(n.participants||[],", ");C.innerHTML=`<div><strong>Участники:</strong> ${P}</div>`,o.appendChild(C),h.addEventListener("click",()=>{const g=C.style.display==="block";C.style.display=g?"none":"block",h.textContent=g?"Показать участников":"Скрыть участников"}),m.addEventListener("click",()=>{const g=this.data.find(v=>v.id!==n.id);if(g){const v=D(n.participants,g.participants);alert(`Участники, которые есть в этом сообществе, но нет в другом:
${L(v)}`)}}),b.addEventListener("click",()=>{const g=n.title,v=M(g),T=$(g);alert(`Проверка названия сообщества "${g}":
Метод 1: ${v?"Палиндром":"Не палиндром"}
Метод 2: ${T?"Палиндром":"Не палиндром"}`)}),e.appendChild(r)}),e.querySelectorAll("button[data-dir]").forEach(n=>{n.addEventListener("click",a=>{const r=parseInt(a.target.dataset.index),o=a.target.dataset.dir==="up"?r-1:r+1;o>=0&&o<this.data.length&&(this.data=A(this.data,r,o),this.render())})}),document.getElementById("search-btn").addEventListener("click",()=>{const n=document.getElementById("search-input").value.toLowerCase(),a=this.data.filter(r=>r.title.toLowerCase().includes(n));a.length===0?alert("Сообщества не найдены."):this.renderWithData(a)}),document.getElementById("add-btn").addEventListener("click",()=>{this.showAddCardForm()})}}const H=document.getElementById("root"),R=new w(H);R.render();
